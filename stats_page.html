<!DOCTYPE html>
<html>
  <head>
    <title>FoodKeep</title>
    <meta charset="utf-8"/>
    
    <!-- AuthUI API -->
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
    
    <!-- Firebase API -->
    <script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
    
    <!-- JQuery API -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <!-- JQueryUI API and stylesheet -->
    <link rel="stylesheet" href="./js/jquery-ui/jquery-ui.css">
    <script src="./js/jquery-ui/jquery-ui.js"></script>
    
    <!-- Simple modal pop-up handler -->
	<script src="./js/modal/jquery.leanModal.min.js"></script>
    
    <!-- Charts.js API -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
    <script src="./js/graphs/util.js"></script>
    
    <!-- Local stylesheets -->
    <link rel="stylesheet" href = "./css/simple_header.css">
    <link rel="stylesheet" href = "./css/stats_style.css">
    
  </head>
  <body>
    <div id="header">
      <div id="title">Food Keep</div>
      <div id="nav">
        <div id="nav-home"><a href="./home_page.html" class="anchor">Home</a></div>
        <div id="nav-stats" style="border-top: 3px solid #193E4B;border-bottom: 3px solid white;"><a href="#" class="anchor">Stats</a></div>
        <div id="nav-list"><a href="./add_item_page.html" class="anchor">My List</a></div>
      </div>
      <div id="login">
        <a id="login-anchor" rel="leanModal" name="login-dialog" href="#login-dialog" class="anchor">Login</a>
        <a href="#" id="logout-anchor" class="anchor">Sign Out</a>
        <a href="#" class="anchor">Settings</a>
        <div id="user-greeting" style="color: white; font-weight: bold;"></div>
      </div>
    </div>
    <div id="login-dialog" title="Log In">
      <div id="firebaseui-auth-container"></div>
      <!--<div id="loader">Loading...</div>-->
    </div>
    <div id="content">
      <div id="graph-container">
        <div id="graph">
          <canvas id="chart-0"></canvas></div>
      </div>
    </div>
    <!-- Firebase linking and auth scripts -->
    <script src="./js/database/setup_firebase.js"></script>
    <script src="./js/database/on_login_events.js"></script>
    
    <!-- LeanModal login dialog pop-up -->
    <script>$("#login-anchor").leanModal();</script>
    
	<script>
		var count = [];
		var countNames= [];
		function updateMe(user) {
      if (user) {
        let listRef = firebase.database().ref("users/" + user.uid + '/expiredList');
        listRef.once('value').then(function(snapshot) {
          snapshot.forEach(function(childSnapshot) {
            let jsonItem = childSnapshot.val();
            let xexpired = jsonItem['timesExpired'];
						let xname = jsonItem['name'];
						console.log(xexpired);
						count.push(xexpired)
						countNames.push(xname);
						console.log(count + countNames);
						if (count.length >= 5) {
							/*var sortedxList= [];
							for (var i = 0; i < count.length; i ++) {
								sortedxList.push({'name' : countNames[0], 'counted' : count });
							}
							sortedxList.sort(function(a, b) {
								return ((a.counted < b.name) ? - 1 : ((a.counted == b.counted) ? 0 : 1));
							});
							console.log("test sort" + sortedxList);
							*/
							count.sort();
							var valOne = count[0];
							var valTwo = count[1];
							var valThree = count[2];
							var valFour = count[3];
							var valFive = count[4];
							
							var ctx = document.getElementById('chart-0').getContext('2d');
							var myChart = new Chart(ctx, {
							type: 'bar',
							data: {
								labels: ['Item 1', 'Item 2', 'Item 3', 'Item 4', 'Item 5'],
								datasets: [{
									label: 'Your 5 most expired Items so far: ',
										data: [valOne, valTwo, valThree, valFour, valFive],
											backgroundColor: [
												'rgba(255, 99, 132, 0.2)',
												'rgba(54, 162, 235, 0.2)',
												'rgba(255, 206, 86, 0.2)',
												'rgba(75, 192, 192, 0.2)',
												'rgba(153, 102, 255, 0.2)'
											],
											borderColor: [
												'rgba(255, 99, 132, 1)',
												'rgba(54, 162, 235, 1)',
												'rgba(255, 206, 86, 1)',
												'rgba(75, 192, 192, 1)',
												'rgba(153, 102, 255, 1)'
											],
											borderWidth: 1
									}]
							},
							options: {
									scales: {
											yAxes: [{
													ticks: {
															beginAtZero: true
													}
											}]
										}
									}
							}); 
						} else{
							console.log("Not enough Data");
							}
					});
				});
			}
    }    
		console.log(count);
		if (count.length >= 5) {
			var ctx = document.getElementById('chart-0').getContext('2d');
			var myChart = new Chart(ctx, {

					type: 'bar',
					data: {
							labels: ['Item 1', 'Item 2', 'Item 3', 'Item 4', 'Item 5'],
							datasets: [{
									label: 'Your 5 most expired Items so far: ',
									data: [12, 19, 3, 5, 2],
									backgroundColor: [
											'rgba(255, 99, 132, 0.2)',
											'rgba(54, 162, 235, 0.2)',
											'rgba(255, 206, 86, 0.2)',
											'rgba(75, 192, 192, 0.2)',
											'rgba(153, 102, 255, 0.2)'
									],
									borderColor: [
											'rgba(255, 99, 132, 1)',
											'rgba(54, 162, 235, 1)',
											'rgba(255, 206, 86, 1)',
											'rgba(75, 192, 192, 1)',
											'rgba(153, 102, 255, 1)'
									],
									borderWidth: 1
							}]
					},
					options: {
							scales: {
									yAxes: [{
											ticks: {
													beginAtZero: true
											}
									}]
							}
					}
			}); 
	} else{
		console.log("Not enough Data");
	}
</script>
  </body>
</html>